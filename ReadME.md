## STK Push or Lipa Na MPesa Online (LMNO) Documentation
[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![PHP Version Require: 7.4](https://img.shields.io/badge/PHP-7.4-blue.svg)](https://www.php.net/releases/7_4_0.php)

All Configurations happen in the following file:
```console
src/config/conf.php
```

### 1. ```Consumer Key``` and ```Consumer Secret``` Configuration
All the Consumer Keys and Secrets are set in the ```apps``` array as shown below:
If the environment is in ```development```, that is, ```sandbox```, then set the keys under ```sandbox_default``` as shown below.
If you the environment is in ```production```, and your apps have Gone Live in the **[Daraja Developer Portal](https://developer.safaricom.co.ke/)**, then use the keys for the live apps in ``c2b`` and ```b2c``` and ```lmno```.
```console
    /* Credentials
     * *************************************************************************************************************
     * The MPESA API Credentials
     */
    'apps' => [
        'c2b' => [
            'consumer_key' => '',
            'consumer_secret' => '',
        ],
        'b2c' => [
            'consumer_key' => '',
            'consumer_secret' => '',
        ],
        'lmno' => [
            'consumer_key' => '',
            'consumer_secret' => '',
        ],
        'sandbox_default' => [
            'consumer_key' => 'wYJfGq7PlEDkymEVeJr0go9DJVOkANXep5DEzrwE6Mz3jAce',
            'consumer_secret' => 'dE0qi2keFqWNQrbVHVAAYN3Hta7LAhPJzgw7wOaU94HPsbghkqAkHdAh9dC19A7Z',
        ],
        'sandbox_c2b' => [
            'consumer_key' => '',
            'consumer_secret' => '',
        ],
    ],
```

### 2. ```lmno``` Configuration
The next stage is setting up the lmno variables.
For the ```sandbox``` environment we set it as follows:
```console
/* LNM Online Configurations
 * *************************************************************************************************************
 */
'lnmo' => [
    /*
     * Paybill Number
     * *********************************************************************************************************
     * The Registered Paybill Number that is used as the Merchant ID
     */
    'short_code' => 174379,
    /*
     * STK Push Callback URL
     * *********************************************************************************************************
     * A fully qualified endpoint that will be queried by Safaricom API
     * on completion or failure of a push transaction
     */
    'callback' => 'https://domain.com/api/v1/stk/callback.php',
    /*
     * SAG Passkey
     * *********************************************************************************************************
     * The secre SAG Passkey generated by Safaricom on successful
     * registrations of the Merchant's Paybill Number.
     */
    'passkey' => 'bfb279f9aa9bdbcf158e97dd71a467cd2e0c893059b10f78e6b72ada1ed2c919',
    /*
     * Default Transaction Type
     * *********************************************************************************************************
     * This is the Default Transaction Type set on every STK Push request
     */
    'default_transaction_type' => 'CustomerPaybillOnline'
]
```

### 3. Creating a Sandbox App for Lipa na Mpesa Express in Daraja Developer Portal
Follow these steps to create a sandbox app for testing Lipa na Mpesa Express integration in the Daraja Developer Portal:
1. **Sign In or Create an Account**:
   - Visit the [Daraja Developer Portal](https://developer.safaricom.co.ke/) and sign in with your credentials or create a new account.

2. **Access the Dashboard**:
   - Navigate to the developer dashboard or home page after signing in.

3. **Create a New Sandbox App**:
   - Look for an option like "My Apps" or "Create New App" in the dashboard menu.
   - Click on it to create a new app.

4. **Fill in App Details**:
   - Enter a name for your sandbox app, such as "Lipa na Mpesa Express Sandbox."
   - Choose the API products or services you want to use with this app, such as Lipa na Mpesa Express.

5. **Generate Sandbox Credentials**:
   - Generate sandbox credentials for your app, including an API key and API secret for authentication with the Daraja API in the sandbox environment.

6. **Configure Callback URLs (Optional)**:
   - If your app requires callback URLs for transaction notifications or other purposes, configure them in the sandbox app settings.

7. **Save and Finish**:
   - Review the app details and credentials to ensure accuracy.
   - Save your changes and complete the process of creating the sandbox app.

8. **Start Testing**:
   - Use the sandbox credentials (API key and secret) in your app code to make API requests and simulate transactions without affecting real M-Pesa accounts.

9. **Monitor and Debug**:
   - Monitor API responses, transaction logs, and error messages as you test your app's integration with the Daraja API.
   - Debug and refine your integration to ensure smooth functionality.

#### Additional Resources
- [Daraja Developer Portal](https://developer.safaricom.co.ke/)
- [Lipa na Mpesa Express API Documentation](https://developer.safaricom.co.ke/lipa-na-m-pesa-online/apis/post/stkpush/v1/processrequest)

Feel free to explore the Daraja Developer Portal documentation for more details on integrating with Lipa na Mpesa Express and other M-Pesa APIs.